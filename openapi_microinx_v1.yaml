openapi: 3.0.3
info:
  title: MicroInX Integration Adapter API
  version: "1.0.0"
  description: |
    Format-stable OpenAPI contract for the MicroInX Integration Adapter v1.0.

    Determinism: identical request bodies must yield identical 200 responses
    for the tuple {template_id, output_text, sdt}.

    Release integrity: the server verifies the MicroInX release manifest on startup
    and refuses to serve if any required file hash mismatches.

    Note: manifest-hash mismatch is a server refusal (startup failure), not an HTTP
    response in v1.0. This contract includes a stable refusal shape in components.
servers:
  - url: http://127.0.0.1:8080
paths:
  /health:
    get:
      operationId: health
      summary: Health check
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HealthResponse"
              examples:
                ok:
                  value:
                    status: ok
                    version: "1.0.0"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                notFound:
                  value:
                    error: not_found
  /insight:
    post:
      operationId: insight
      summary: Generate a deterministic BladeInsight
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/InsightRequest"
            examples:
              example:
                value:
                  text: "Need more context and more research; later it depends. I revisit again and still."
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/InsightResponse"
        "400":
          description: Bad request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                badJson:
                  value:
                    error: bad_json
                missingText:
                  value:
                    error: missing_text
                badContentLength:
                  value:
                    error: bad_content_length
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                notFound:
                  value:
                    error: not_found
        "500":
          description: Internal error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
              examples:
                engineError:
                  value:
                    error: engine_error
                    detail: "<string>"
components:
  schemas:
    InsightRequest:
      type: object
      additionalProperties: false
      required: [text]
      properties:
        text:
          type: string
          minLength: 1
          description: Raw input text for the deterministic MicroInX engine.

    InsightResponse:
      type: object
      additionalProperties: false
      required: [template_id, output_text, sdt, manifest]
      properties:
        template_id:
          type: string
        output_text:
          type: string
        sdt:
          $ref: "#/components/schemas/SDTResult"
        manifest:
          $ref: "#/components/schemas/ManifestStatus"

    SDTResult:
      type: object
      additionalProperties: false
      required: [pass, violations]
      properties:
        pass:
          type: boolean
        violations:
          type: array
          items:
            type: string

    ManifestStatus:
      type: object
      additionalProperties: false
      required: [version, hash_ok]
      properties:
        version:
          type: string
        hash_ok:
          type: boolean

    HealthResponse:
      type: object
      additionalProperties: false
      required: [status, version]
      properties:
        status:
          type: string
          enum: [ok]
        version:
          type: string

    ErrorResponse:
      type: object
      additionalProperties: false
      required: [error]
      properties:
        error:
          type: string
        detail:
          type: string

    # Stable refusal shape for startup integrity failure.
    # This is not an HTTP response in v1.0; the server refuses to start.
    ManifestRefusal:
      type: object
      additionalProperties: false
      required: [error]
      properties:
        error:
          type: string
          enum: [manifest_hash_mismatch]
        detail:
          type: string
